#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Running pre-push hooks..."

# Run full test suite
echo "üß™ Running test suite..."
npm run test:ci 2>/dev/null || {
    echo "‚ùå Tests failed. Please fix failing tests before pushing."
    exit 1
}

# Run Python tests
echo "üêç Running Python tests..."
cd apps/backend-rag && python -m pytest tests/ --cov=. --cov-fail-under=80 2>/dev/null || {
    echo "‚ùå Python tests failed or coverage below 80%. Please fix tests."
    exit 1
}

# Check for TODO/FIXME in new code
echo "üìã Checking for new TODO/FIXME comments..."
if git diff --name-only origin/HEAD...HEAD | xargs grep -l 'TODO\|FIXME\|HACK\|BUG' 2>/dev/null; then
    echo "‚ö†Ô∏è  WARNING: Found TODO/FIXME comments in new code."
    echo "   Please consider creating GitHub issues for these items."
    echo "   Use format: TODO: https://github.com/username/repo/issues/123"
fi

echo "‚úÖ All pre-push checks passed!"
