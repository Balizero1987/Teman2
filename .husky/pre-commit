#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit hooks..."

# Check for print statements in Python files
echo "ğŸ Checking for print() statements in Python files..."
if git diff --cached --name-only | grep -E '\.py$' | xargs grep -l 'print(' 2>/dev/null; then
    echo "âŒ ERROR: Found print() statements in staged Python files."
    echo "   Please replace print() with logger.info/debug/error()"
    echo "   Use logger = logging.getLogger(__name__) at the top of your file"
    exit 1
fi

# Check for console.log in TypeScript/JavaScript files
echo "ğŸ“œ Checking for console.log statements in TypeScript/JavaScript files..."
if git diff --cached --name-only | grep -E '\.(ts|tsx|js|jsx)$' | xargs grep -l 'console\.\(log\|debug\|info\|warn\|error\)' 2>/dev/null; then
    echo "âŒ ERROR: Found console statements in staged TypeScript/JavaScript files."
    echo "   Please replace console.* with logger from src/lib/logger.ts"
    echo "   Example: import { logger } from '@/lib/logger'; logger.info('message');"
    exit 1
fi

# Run linting
echo "ğŸ”§ Running linting..."
npm run lint:check 2>/dev/null || {
    echo "âŒ Linting failed. Please fix linting issues."
    exit 1
}

# Run type checking
echo "ğŸ“ Running type checking..."
npm run typecheck 2>/dev/null || {
    echo "âŒ Type checking failed. Please fix type errors."
    exit 1
}

# Run Python linting
echo "ğŸ Running Python linting..."
cd apps/backend-rag && ruff check . 2>/dev/null || {
    echo "âŒ Python linting failed. Please fix ruff issues."
    exit 1
}

echo "âœ… All pre-commit checks passed!"
