# SYSTEM OVERVIEW

*Auto-generated by The Scribe on 2025-12-23 02:30:56*

> **Note:** This document is automatically updated. Do not edit manually.

---

## Quick Statistics

- **Total API Routes:** 199
- **Modules:** 298
- **Services:** 79
- **Agents:** 5

---

## ðŸ§  System Consciousness (4D Map)

The Nuzantara system is organized across 4 dimensions as defined in [SYSTEM_MAP_4D.md](./SYSTEM_MAP_4D.md):

1. **DIMENSION 1: STRUTTURA (Space)**: The physical and logical organization of the monorepo and services.
2. **DIMENSION 2: FLUSSO (Time/Flow)**: The lifecycle of requests and the intelligence-to-knowledge data pipeline.
3. **DIMENSION 3: LOGICA (Relationships)**: Authentication flows, query routing, and the memory/agent architecture.
4. **DIMENSION 4: SCALA (Metrics)**: Real-time verification of documents, tables, and test coverage.

---

## API Endpoints Summary

###  (13 endpoints)

**GET:**
- `/`
- `/api/csrf-token`
- `/api/dashboard/stats`
- `/api/intel/critical`
- `/api/intel/stats/{collection}`
- `/api/intel/trends`
- `/api/v2/bali-zero/chat-stream`
- `/bali-zero/chat-stream`
- `/debug/parent-documents/{document_id}`
- `/debug/parent-documents/{document_id}/{bab_id}`

**POST:**
- `/api/chat/stream`
- `/api/intel/search`
- `/api/intel/store`

### Audio (2 endpoints)

**POST:**
- `/audio/speech`
- `/audio/transcribe`

### Collective Memory (4 endpoints)

**GET:**
- `/api/collective-memory/facts`
- `/api/collective-memory/stats`

**POST:**
- `/api/collective-memory/contribute`
- `/api/collective-memory/refute`

### Episodic Memory (6 endpoints)

**DELETE:**
- `/api/episodic-memory/events/{event_id}`

**GET:**
- `/api/episodic-memory/context`
- `/api/episodic-memory/stats`
- `/api/episodic-memory/timeline`

**POST:**
- `/api/episodic-memory/events`
- `/api/episodic-memory/extract`

### Oracle INGEST (2 endpoints)

**GET:**
- `/api/oracle/collections`

**POST:**
- `/api/oracle/ingest`

### Oracle v5.3 - Ultra Hybrid (6 endpoints)

**GET:**
- `/api/oracle/drive/test`
- `/api/oracle/gemini/test`
- `/api/oracle/health`
- `/api/oracle/user/profile/{user_email}`

**POST:**
- `/api/oracle/feedback`
- `/api/oracle/query`

### agentic-functions (16 endpoints)

**GET:**
- `/api/agents/analytics/summary`
- `/api/agents/compliance/alerts`
- `/api/agents/compliance/client/{client_id}`
- `/api/agents/ingestion/status`
- `/api/agents/journey/{journey_id}`
- `/api/agents/journey/{journey_id}/next-steps`
- `/api/agents/knowledge-graph/export`
- `/api/agents/status`

**POST:**
- `/api/agents/compliance/track`
- `/api/agents/ingestion/run`
- `/api/agents/journey/create`
- `/api/agents/journey/{journey_id}/step/{step_id}/complete`
- `/api/agents/knowledge-graph/extract`
- `/api/agents/pricing/calculate`
- `/api/agents/research/autonomous`
- `/api/agents/synthesis/cross-oracle`

### agentic-rag (2 endpoints)

**POST:**
- `/api/agentic-rag/query`
- `/api/agentic-rag/stream`

### authentication (6 endpoints)

**GET:**
- `/api/auth/check`
- `/api/auth/csrf-token`
- `/api/auth/profile`

**POST:**
- `/api/auth/login`
- `/api/auth/logout`
- `/api/auth/refresh`

### autonomous-tier1 (9 endpoints)

**GET:**
- `/api/autonomous-agents/executions`
- `/api/autonomous-agents/executions/{execution_id}`
- `/api/autonomous-agents/scheduler/status`
- `/api/autonomous-agents/status`

**POST:**
- `/api/autonomous-agents/client-value-predictor/run`
- `/api/autonomous-agents/conversation-trainer/run`
- `/api/autonomous-agents/knowledge-graph-builder/run`
- `/api/autonomous-agents/scheduler/task/{task_name}/disable`
- `/api/autonomous-agents/scheduler/task/{task_name}/enable`

### conversations (8 endpoints)

**DELETE:**
- `/api/bali-zero/conversations/clear`
- `/api/bali-zero/conversations/{conversation_id}`

**GET:**
- `/api/bali-zero/conversations/history`
- `/api/bali-zero/conversations/list`
- `/api/bali-zero/conversations/memory/context`
- `/api/bali-zero/conversations/stats`
- `/api/bali-zero/conversations/{conversation_id}`

**POST:**
- `/api/bali-zero/conversations/save`

### crm-clients (8 endpoints)

**DELETE:**
- `/api/crm/clients/{client_id}`

**GET:**
- `/api/crm/clients/`
- `/api/crm/clients/by-email/{email}`
- `/api/crm/clients/stats/overview`
- `/api/crm/clients/{client_id}`
- `/api/crm/clients/{client_id}/summary`

**PATCH:**
- `/api/crm/clients/{client_id}`

**POST:**
- `/api/crm/clients/`

### crm-interactions (7 endpoints)

**GET:**
- `/api/crm/interactions/`
- `/api/crm/interactions/client/{client_id}/timeline`
- `/api/crm/interactions/practice/{practice_id}/history`
- `/api/crm/interactions/stats/overview`
- `/api/crm/interactions/{interaction_id}`

**POST:**
- `/api/crm/interactions/`
- `/api/crm/interactions/from-conversation`

### crm-practices (8 endpoints)

**GET:**
- `/api/crm/practices/`
- `/api/crm/practices/active`
- `/api/crm/practices/renewals/upcoming`
- `/api/crm/practices/stats/overview`
- `/api/crm/practices/{practice_id}`

**PATCH:**
- `/api/crm/practices/{practice_id}`

**POST:**
- `/api/crm/practices/`
- `/api/crm/practices/{practice_id}/documents/add`

### crm-shared-memory (4 endpoints)

**GET:**
- `/api/crm/shared-memory/client/{client_id}/full-context`
- `/api/crm/shared-memory/search`
- `/api/crm/shared-memory/team-overview`
- `/api/crm/shared-memory/upcoming-renewals`

### debug (26 endpoints)

**DELETE:**
- `/api/debug/traces`

**GET:**
- `/api/debug/db/queries/analyze`
- `/api/debug/db/queries/recent`
- `/api/debug/db/queries/slow`
- `/api/debug/logs`
- `/api/debug/parent-documents-public/{document_id}`
- `/api/debug/parent-documents/{document_id}/{bab_id}/text`
- `/api/debug/postgres/connection`
- `/api/debug/postgres/performance/connections`
- `/api/debug/postgres/performance/locks`
- `/api/debug/postgres/performance/slow-queries`
- `/api/debug/postgres/schema/indexes`
- `/api/debug/postgres/schema/table/{table_name}`
- `/api/debug/postgres/schema/tables`
- `/api/debug/postgres/stats/database`
- `/api/debug/postgres/stats/tables`
- `/api/debug/qdrant/collection/{collection_name}/stats`
- `/api/debug/qdrant/collections/health`
- `/api/debug/rag/pipeline/{correlation_id}`
- `/api/debug/request/{request_id}`
- `/api/v1/debug/sentry-test`
- `/api/debug/services`
- `/api/debug/state`
- `/api/debug/traces/recent`

**POST:**
- `/api/debug/postgres/query`
- `/api/debug/profile`

### feedback (2 endpoints)

**GET:**
- `/api/feedback/ratings/{session_id}`

**POST:**
- `/api/feedback/rate-conversation`

### handlers (3 endpoints)

**GET:**
- `/api/handlers/category/{category}`
- `/api/handlers/list`
- `/api/handlers/search`

### health (6 endpoints)

**GET:**
- `/health`
- `/health/`
- `/health/detailed`
- `/health/live`
- `/health/metrics/qdrant`
- `/health/ready`

### identity (1 endpoints)

**POST:**
- `/team/login`

### image (1 endpoints)

**POST:**
- `/api/v1/image/generate`

### ingestion (4 endpoints)

**GET:**
- `/api/ingest/stats`

**POST:**
- `/api/ingest/batch`
- `/api/ingest/file`
- `/api/ingest/upload`

### knowledge (3 endpoints)

**GET:**
- `/api/search/debug/parent-documents/{document_id}`
- `/api/search/health`

**POST:**
- `/api/search/`

### legal-ingestion (7 endpoints)

**GET:**
- `/api/legal/collections/stats`
- `/api/legal/parent-documents/{document_id}`
- `/api/legal/parent-documents/{document_id}/{bab_id}/text`

**POST:**
- `/api/legal/ingest`
- `/api/legal/ingest-batch`
- `/api/legal/parent-documents`
- `/api/legal/upload`

### media (2 endpoints)

**POST:**
- `/media/generate-image`
- `/media/upload`

### memory (8 endpoints)

**DELETE:**
- `/api/memory/{memory_id}`

**GET:**
- `/api/memory/health`
- `/api/memory/stats`

**POST:**
- `/api/memory/embed`
- `/api/memory/init`
- `/api/memory/search`
- `/api/memory/similar`
- `/api/memory/store`

### nusantara (1 endpoints)

**GET:**
- `/nusantara/health`

### performance (5 endpoints)

**GET:**
- `/api/performance/cache/stats`
- `/api/performance/metrics`

**POST:**
- `/api/performance/clear-cache`
- `/api/performance/clear-cache/embedding`
- `/api/performance/clear-cache/search`

### public (1 endpoints)

**GET:**
- `/api/public/bab/{document_id}`

### sessions (12 endpoints)

**DELETE:**
- `/api/sessions/{session_id}`

**GET:**
- `/api/sessions/analytics/overview`
- `/api/sessions/health`
- `/api/sessions/{session_id}`
- `/api/sessions/{session_id}/export`
- `/api/sessions/{session_id}/info`

**POST:**
- `/api/sessions/cleanup`
- `/api/sessions/create`
- `/api/sessions/{session_id}/extend`
- `/api/sessions/{session_id}/extend-custom`

**PUT:**
- `/api/sessions/{session_id}`
- `/api/sessions/{session_id}/ttl`

### team-activity (9 endpoints)

**GET:**
- `/api/team/activity/monthly`
- `/api/team/activity/weekly`
- `/api/team/export`
- `/api/team/health`
- `/api/team/hours`
- `/api/team/my-status`
- `/api/team/status`

**POST:**
- `/api/team/clock-in`
- `/api/team/clock-out`

### team-analytics (7 endpoints)

**GET:**
- `/api/team-analytics/burnout`
- `/api/team-analytics/optimal-hours`
- `/api/team-analytics/patterns`
- `/api/team-analytics/productivity`
- `/api/team-analytics/team-insights`
- `/api/team-analytics/trends/{user_email}`
- `/api/team-analytics/workload-balance`

---

## Key Modules

### `export_bab`

Export BAB to JSON - run this FROM INSIDE the backend container

### `middleware.error_monitoring`

Error Monitoring Middleware
Captures 4xx/5xx HTTP errors and sends alerts

### `middleware.hybrid_auth`

Hybrid Authentication Middleware - Fail-Closed Implementation
Combines API Key, Cookie JWT, and Header JWT authentication for flexible access control.

Authentication Priority:
1. API Key (X-API-Key h...

### `middleware.rate_limiter`

Rate Limiting Middleware for ZANTARA
Prevents API abuse and ensures fair usage

Features:
- IP-based rate limiting
- User-based rate limiting
- Configurable limits per endpoint
- Redis-backed for dist...

### `middleware.request_tracing`

Request Tracing Middleware
Provides end-to-end request tracing with correlation IDs

### `migrations.apply_migration_012`

Apply Migration 012: Fix Production Schema Issues
Adds missing conversation_id column to interactions table

### `migrations.apply_migration_013`

Apply Migration 013: Agentic RAG Tables
Creates tables for Parent-Child Retrieval and Golden Router

### `migrations.migrate_crm_schema`

Apply CRM System Schema Migration
Connects to Fly.io PostgreSQL and applies migration 007

### `migrations.migration_007`

Migration 007: CRM System Schema
Creates tables for CRM system (team_members, clients, practices, interactions, etc.)

### `migrations.migration_012`

Migration 012: Fix Production Schema Issues
Adds missing conversation_id column to interactions table

### `migrations.migration_013`

Migration 013: Agentic RAG Tables
Creates tables for Parent-Child Retrieval and Golden Router

### `migrations.migration_015`

Migration 015: Add Drive Columns
Adds Google Drive metadata to parent_documents table

### `migrations.migration_016`

Migration 016: Add Summary to Parent Documents
Adds summary column to parent_documents table

### `migrations.migration_018`

Migration 018: Collective Memory System
Creates tables for shared knowledge learned from multiple users

### `migrations.migration_019`

Migration 019: Episodic Memory System
Creates table for storing timeline of user events and experiences

### `migrations.migration_021`

Migration 021: Memory-Knowledge Graph Integration
Links memory_facts and episodic_memories to kg_entities

### `migrations.migration_021_add_bm25_sparse_vectors`

Migration 021: Add BM25 Sparse Vectors for Hybrid Search

This migration adds BM25 sparse vectors to the legal_unified collection
to enable hybrid search (dense + sparse) with Reciprocal Rank Fusion (...

### `migrations.migration_022`

Migration 022: Performance Indexes
Adds critical indexes for memory_facts and user_stats tables to prevent full table scans.

### `verify_draft_pattern`

Test Draft-Verify Logic
Simulates a query that might cause hallucinations (fake law) to see if Verifier catches it.

### `verify_soul_persona`

Verify Soul Persona - Test script for Zantara personality

UPDATED 2025-12-23:
- Migrated to new google-genai SDK via GenAIClient wrapper

---

*Last updated: 2025-12-23 02:30:56*

For detailed documentation, see [LIVING_ARCHITECTURE.md](./LIVING_ARCHITECTURE.md)